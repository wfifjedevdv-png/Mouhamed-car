<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</title>

<style>
:root{
 --bg1:#05070c;
 --bg2:#0b0f17;
 --blue:#1e90ff;
 --glass:rgba(255,255,255,.1);
 --border:rgba(255,255,255,.2);
}

*{box-sizing:border-box;font-family:Segoe UI,Tahoma}

body{
 margin:0;
 min-height:100vh;
 background:linear-gradient(180deg,var(--bg1),var(--bg2));
 color:white;
}

.container{
 max-width:900px;
 margin:auto;
 padding:20px;
}

.back{
 background:none;
 border:none;
 color:var(--blue);
 cursor:pointer;
 font-size:16px;
 margin-bottom:14px;
}

.card{
 background:var(--glass);
 backdrop-filter:blur(14px);
 border-radius:26px;
 padding:18px;
 border:1px solid var(--border);
}

.card img{
 width:100%;
 height:360px;
 object-fit:cover;
 border-radius:22px;
}

h2{margin:14px 0 6px}

.price{
 color:var(--blue);
 font-size:22px;
 font-weight:bold;
 margin-bottom:10px;
}

.desc{opacity:.9;line-height:1.7}

/* â­ STARS */
.stars span{
 font-size:30px;
 cursor:pointer;
 color:#555;
 transition:.2s;
}
.stars span.active,
.stars span:hover{color:gold}

.avg{margin-top:6px;color:#ccc}

/* ğŸ’¬ COMMENTS */
.comment{
 background:rgba(255,255,255,.08);
 padding:12px;
 border-radius:14px;
 margin-top:10px;
 border:1px solid var(--border);
}

.comment small{color:#aaa}

input,textarea,button{
 width:100%;
 margin-top:12px;
 padding:12px;
 border-radius:14px;
 border:none;
 background:#0f1420;
 color:white;
}

textarea{resize:none;height:90px}

button.send{
 background:linear-gradient(135deg,#1e90ff,#3aa0ff);
 font-weight:600;
 cursor:pointer;
}

.empty{opacity:.6;text-align:center;margin-top:10px}

/* ğŸ›’ CART ICON */
#cartIcon{
 position:fixed;
 top:18px;
 left:18px;
 width:48px;
 height:48px;
 border-radius:50%;
 background:#1e90ff;
 color:white;
 display:flex;
 align-items:center;
 justify-content:center;
 font-size:22px;
 cursor:pointer;
 z-index:999;
}

/* ğŸ›’ CART BOX */
#cartBox{
 position:fixed;
 top:80px;
 left:18px;
 width:280px;
 max-height:380px;
 overflow:auto;
 background:#0b0f17;
 border:1px solid rgba(255,255,255,.15);
 border-radius:18px;
 padding:12px;
 display:none;
 z-index:999;
}

.cartItem{
 display:flex;
 gap:8px;
 margin-bottom:10px;
}

.cartItem img{
 width:60px;
 border-radius:10px;
}

.cartItem .price{
 color:#3aa0ff;
 font-size:14px;
}
</style>
</head>

<body>

<!-- ğŸ›’ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¹Ø±Ø¨Ø© -->
<div id="cartIcon" onclick="toggleCart()">ğŸ›’</div>

<!-- ğŸ›’ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¹Ø±Ø¨Ø© -->
<div id="cartBox">
 <h3>ğŸ›’ Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h3>
 <div id="cartList"></div>
</div>

<div class="container">

<button class="back" onclick="goBack()">â¬… Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…Ø¹Ø±Ø¶</button>

<div class="card" id="card" style="display:none">
 <img id="img">
 <h2 id="name"></h2>
 <div class="price" id="price"></div>
 <div class="desc" id="desc"></div>

 <button class="send" onclick="addToCart()">ğŸ›’ Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚</button>

 <hr style="opacity:.2">

 <h3>â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
 <div class="stars" id="stars"></div>
 <div class="avg" id="avg"></div>

 <hr style="opacity:.2">

 <h3>ğŸ’¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</h3>
 <input id="cname" placeholder="Ø§Ø³Ù…Ùƒ">
 <textarea id="ctext" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ"></textarea>
 <button class="send" onclick="addComment()">Ø¥Ø±Ø³Ø§Ù„</button>

 <div id="comments"></div>
</div>

</div>

<script>
/* Ø­Ù…Ø§ÙŠØ© */
if(!localStorage.getItem("session")){
 location.href="index.html";
}

/* Ø¨ÙŠØ§Ù†Ø§Øª */
const cars = JSON.parse(localStorage.getItem("cars") || "[]");
const i = localStorage.getItem("currentCar");

if(!cars.length || i === null || !cars[i]){
 document.body.innerHTML="<h2 style='text-align:center;margin-top:80px'>ğŸš« Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ§Ø±Ø©</h2>";
 throw "";
}

const car = cars[i];
car.comments ||= [];
car.rates ||= [];

/* Ø¹Ø±Ø¶ */
card.style.display="block";
img.src = car.img;
name.innerText = car.name;
price.innerText = car.price;
desc.innerText = car.desc;

/* ğŸ›’ CART */
function getCartKey(){
 const s = JSON.parse(localStorage.getItem("session"));
 return "cart_" + s.email;
}

function addToCart(){
 const key = getCartKey();
 const cart = JSON.parse(localStorage.getItem(key) || "[]");
 cart.push(car);
 localStorage.setItem(key, JSON.stringify(cart));
 renderCart();
}

function toggleCart(){
 const box = document.getElementById("cartBox");
 box.style.display = box.style.display==="block"?"none":"block";
 renderCart();
}

function renderCart(){
 const s = JSON.parse(localStorage.getItem("session"));
 const cart = JSON.parse(localStorage.getItem("cart_"+s.email) || "[]");
 const list = document.getElementById("cartList");
 list.innerHTML="";
 if(!cart.length){
  list.innerHTML="<p style='opacity:.6'>Ø§Ù„Ø¹Ø±Ø¨Ø© ÙØ§Ø±ØºØ©</p>";
  return;
 }
 cart.forEach(c=>{
  list.innerHTML+=`
   <div class="cartItem">
    <img src="${c.img}">
    <div>
     <div>${c.name}</div>
     <div class="price">${c.price}</div>
    </div>
   </div>
  `;
 });
}

/* â­ Stars */
for(let x=1;x<=5;x++){
 stars.innerHTML+=`<span onclick="rate(${x})">â˜…</span>`;
}
updateStars();

function rate(n){
 car.rates.push(n);
 save();
 updateStars();
}

function updateStars(){
 let avgNum=car.rates.length
 ?car.rates.reduce((a,b)=>a+b)/car.rates.length:0;
 avg.innerText=car.rates.length?`Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${avgNum.toFixed(1)} â­`:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…";
 [...stars.children].forEach((s,i)=>{
  s.classList.toggle("active",i<Math.round(avgNum));
 });
}

/* ğŸ’¬ Comments */
function renderComments(){
 comments.innerHTML="";
 if(!car.comments.length){
  comments.innerHTML="<div class='empty'>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª</div>";
  return;
 }
 car.comments.forEach(c=>{
  comments.innerHTML+=`
   <div class="comment">
    <b>${c.name}</b>
    <small> â€¢ ${c.time}</small>
    <p>${c.text}</p>
   </div>`;
 });
}

function addComment(){
 if(!cname.value.trim()||!ctext.value.trim())return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„");
 car.comments.push({name:cname.value,text:ctext.value,time:new Date().toLocaleString()});
 cname.value="";ctext.value="";
 save();renderComments();
}

function save(){
 localStorage.setItem("cars",JSON.stringify(cars));
}

renderComments();

function goBack(){
 localStorage.removeItem("currentCar");
 location.href="gallery.html";
}
</script>

</body>
</html>
