<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</title>

<style>
:root{
 --bg1:#05070c;
 --bg2:#0b0f17;
 --blue:#1e90ff;
 --glass:rgba(255,255,255,.1);
 --border:rgba(255,255,255,.2);
}

*{box-sizing:border-box;font-family:Segoe UI,Tahoma}

body{
 margin:0;
 min-height:100vh;
 background:linear-gradient(180deg,var(--bg1),var(--bg2));
 color:white;
}

/* ===== HEADER ===== */
.header{
 position:fixed;
 top:0; right:0; left:0;
 height:56px;
 background:#020617;
 display:flex;
 align-items:center;
 justify-content:space-between;
 padding:0 16px;
 z-index:1000;
}

.header h3{margin:0;font-size:18px}

.cart-btn{
 position:relative;
 font-size:22px;
 cursor:pointer;
}

.cart-count{
 position:absolute;
 top:-6px;
 left:-6px;
 background:#ff4d4d;
 color:white;
 font-size:12px;
 padding:2px 6px;
 border-radius:999px;
}

/* ===== CART PANEL ===== */
.cart-panel{
 position:fixed;
 top:56px;
 right:10px;
 width:300px;
 max-height:420px;
 background:#0b0f17;
 border:1px solid rgba(255,255,255,.15);
 border-radius:18px;
 padding:12px;
 display:none;
 z-index:1000;
}

.cart-item{
 display:flex;
 gap:10px;
 margin-bottom:10px;
}

.cart-item img{
 width:60px;
 height:60px;
 object-fit:cover;
 border-radius:10px;
}

.container{
 max-width:900px;
 margin:auto;
 padding:80px 20px 20px;
}

.back{
 background:none;
 border:none;
 color:var(--blue);
 cursor:pointer;
 font-size:16px;
 margin-bottom:14px;
}

.card{
 background:var(--glass);
 backdrop-filter:blur(14px);
 border-radius:26px;
 padding:18px;
 border:1px solid var(--border);
}

.card img{
 width:100%;
 height:360px;
 object-fit:cover;
 border-radius:22px;
}

.price{
 color:var(--blue);
 font-size:22px;
 font-weight:bold;
 margin-bottom:10px;
}

/* â­ STARS */
.stars span{
 font-size:30px;
 cursor:pointer;
 color:#555;
 transition:.2s;
}
.stars span.active,
.stars span:hover{color:gold}

.avg{margin-top:6px;color:#ccc}

/* ğŸ’¬ COMMENTS */
.comment{
 background:rgba(255,255,255,.08);
 padding:12px;
 border-radius:14px;
 margin-top:10px;
 border:1px solid var(--border);
}

.comment small{color:#aaa}

input,textarea,button{
 width:100%;
 margin-top:12px;
 padding:12px;
 border-radius:14px;
 border:none;
 background:#0f1420;
 color:white;
}

textarea{resize:none;height:90px}

button.send{
 background:linear-gradient(135deg,#1e90ff,#3aa0ff);
 font-weight:600;
 cursor:pointer;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
 <h3>ğŸš— Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h3>
 <div class="cart-btn" onclick="toggleCart()">ğŸ›’
  <span class="cart-count" id="cartCount">0</span>
 </div>
</div>

<!-- CART PANEL -->
<div class="cart-panel" id="cartPanel">
 <h4>ğŸ›’ Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h4>
 <div id="cartList"></div>
</div>

<div class="container">
<button class="back" onclick="goBack()">â¬… Ø§Ù„Ø±Ø¬ÙˆØ¹</button>

<div class="card" id="card">
 <img id="img">
 <h2 id="name"></h2>
 <div class="price" id="price"></div>
 <div id="desc"></div>

 <button class="send" onclick="addToCart()">ğŸ›’ Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨Ø©</button>

 <hr style="opacity:.2">

 <h3>â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
 <div class="stars" id="stars"></div>
 <div class="avg" id="avg"></div>

 <hr style="opacity:.2">

 <h3>ğŸ’¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</h3>
 <input id="cname" placeholder="Ø§Ø³Ù…Ùƒ">
 <textarea id="ctext" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ"></textarea>
 <button class="send" onclick="addComment()">Ø¥Ø±Ø³Ø§Ù„</button>

 <div id="comments"></div>
</div>
</div>

<script>
if(!localStorage.getItem("session")) location.href="index.html";

const cars = JSON.parse(localStorage.getItem("cars")||"[]");
const i = localStorage.getItem("currentCar");
const car = cars[i];

car.comments ||= [];
car.rates ||= [];

img.src=car.img;
name.innerText=car.name;
price.innerText=car.price;
desc.innerText=car.desc;

/* â­ ØªÙ‚ÙŠÙŠÙ… */
for(let x=1;x<=5;x++){
 stars.innerHTML+=`<span onclick="rate(${x})">â˜…</span>`;
}
updateStars();

function rate(n){
 car.rates.push(n);
 save();
 updateStars();
}

function updateStars(){
 let avgNum=car.rates.length
 ?car.rates.reduce((a,b)=>a+b)/car.rates.length:0;
 avg.innerText=car.rates.length
 ?`Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${avgNum.toFixed(1)} â­`
 :"Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚ÙŠÙŠÙ…";
 [...stars.children].forEach((s,i)=>{
  s.classList.toggle("active",i<Math.round(avgNum));
 });
}

/* ğŸ’¬ ØªØ¹Ù„ÙŠÙ‚Ø§Øª */
function renderComments(){
 comments.innerHTML="";
 if(!car.comments.length){
  comments.innerHTML="<p style='opacity:.6'>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª</p>";
  return;
 }
 car.comments.forEach(c=>{
  comments.innerHTML+=`
   <div class="comment">
    <b>${c.name}</b>
    <small> â€¢ ${c.time}</small>
    <p>${c.text}</p>
   </div>`;
 });
}

function addComment(){
 if(!cname.value||!ctext.value) return;
 car.comments.push({
  name:cname.value,
  text:ctext.value,
  time:new Date().toLocaleString()
 });
 cname.value=""; ctext.value="";
 save(); renderComments();
}

/* ğŸ›’ Ø§Ù„Ø¹Ø±Ø¨Ø© */
function cartKey(){
 return "cart_"+JSON.parse(localStorage.getItem("session")).email;
}

function addToCart(){
 let cart=JSON.parse(localStorage.getItem(cartKey())||"[]");
 if(cart.find(x=>x.name===car.name)) return alert("Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§");
 cart.push({name:car.name,price:car.price,img:car.img});
 localStorage.setItem(cartKey(),JSON.stringify(cart));
 updateCart();
}

function toggleCart(){
 cartPanel.style.display=
 cartPanel.style.display==="block"?"none":"block";
 updateCart();
}

function updateCart(){
 let cart=JSON.parse(localStorage.getItem(cartKey())||"[]");
 cartCount.innerText=cart.length;
 cartList.innerHTML="";
 if(!cart.length){
  cartList.innerHTML="<p style='opacity:.6'>Ø§Ù„Ø¹Ø±Ø¨Ø© ÙØ§Ø±ØºØ©</p>";
  return;
 }
 cart.forEach(c=>{
  cartList.innerHTML+=`
   <div class="cart-item">
    <img src="${c.img}">
    <div>
     <div>${c.name}</div>
     <div class="price">${c.price}</div>
    </div>
   </div>`;
 });
}

function save(){
 localStorage.setItem("cars",JSON.stringify(cars));
}

renderComments();
updateCart();

function goBack(){
 location.href="gallery.html";
}
</script>

</body>
</html>
