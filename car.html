<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</title>

<style>
body{margin:0;background:#05070c;color:white;font-family:Segoe UI}
.header{display:flex;justify-content:space-between;align-items:center;padding:14px;background:#020617}
.cart-btn{font-size:22px;cursor:pointer}
.container{max-width:900px;margin:auto;padding:20px}
.card{background:rgba(255,255,255,.1);border-radius:24px;padding:20px}
.card img{width:100%;height:320px;object-fit:cover;border-radius:20px}
.price{color:#1e90ff;font-size:22px;font-weight:bold}
button{margin-top:12px;padding:12px;width:100%;border:none;border-radius:14px;background:#1e90ff;color:white}
.stars span{font-size:26px;cursor:pointer;color:#555}
.stars span.active{color:gold}
.comment{background:rgba(255,255,255,.08);padding:10px;border-radius:12px;margin-top:8px}
</style>
</head>

<body>

<div class="header">
 <b>ğŸš— Ø§Ù„ØªÙØ§ØµÙŠÙ„</b>
 <span class="cart-btn" onclick="addToCart()">ğŸ›’</span>
</div>

<div class="container">
 <div class="card">
  <img id="img">
  <h2 id="name"></h2>
  <div class="price" id="price"></div>
  <p id="desc"></p>

  <h3>â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</h3>
  <div class="stars" id="stars"></div>
  <div id="avg"></div>

  <h3>ğŸ’¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</h3>
  <input id="cname" placeholder="Ø§Ø³Ù…Ùƒ">
  <textarea id="ctext" placeholder="ØªØ¹Ù„ÙŠÙ‚Ùƒ"></textarea>
  <button onclick="addComment()">Ø¥Ø±Ø³Ø§Ù„</button>

  <div id="comments"></div>
 </div>
</div>

<script>
const cars = JSON.parse(localStorage.getItem("cars")||"[]");
const id = Number(localStorage.getItem("currentCarId"));
const car = cars.find(c=>c.id===id);

if(!car){document.body.innerHTML="ğŸš« Ø®Ø·Ø£";throw"";}

img.src=car.img;
name.innerText=car.name;
price.innerText=car.price;
desc.innerText=car.desc;

car.comments ||= [];
car.rates ||= [];

for(let i=1;i<=5;i++){
 stars.innerHTML+=`<span onclick="rate(${i})">â˜…</span>`;
}

function rate(n){
 car.rates.push(n);
 save();
 renderStars();
}

function renderStars(){
 let avg=car.rates.length?car.rates.reduce((a,b)=>a+b)/car.rates.length:0;
 avgDiv.innerText=avg?`Ù…ØªÙˆØ³Ø· ${avg.toFixed(1)}`:"";
 [...stars.children].forEach((s,i)=>s.classList.toggle("active",i<avg));
}

function addComment(){
 car.comments.push({name:cname.value,text:ctext.value});
 save();
 renderComments();
}

function renderComments(){
 comments.innerHTML="";
 car.comments.forEach(c=>{
  comments.innerHTML+=`<div class="comment"><b>${c.name}</b><p>${c.text}</p></div>`;
 });
}

function addToCart(){
 let key="cart_user";
 let cart=JSON.parse(localStorage.getItem(key)||"[]");
 if(cart.find(x=>x.id===car.id)) return alert("Ù…ÙˆØ¬ÙˆØ¯Ø©");
 cart.push(car);
 localStorage.setItem(key,JSON.stringify(cart));
 alert("âœ… Ø£Ø¶ÙŠÙØª");
}

function save(){
 localStorage.setItem("cars",JSON.stringify(cars));
}

renderStars();
renderComments();
</script>

</body>
</html>
